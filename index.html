<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Page Title</title>
  <meta name="description" content="Webpage for xxxx">
  <!-- <link rel="stylesheet" href="css/reset/reset.css"> -->
  <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <style>
    #main {
      position: absolute;
      left: 0;
      top: 0;
    }
  </style>
</head>

<body>
  <canvas id="main" width="1000" height="1000"></canvas>
  <script>
    String.prototype.insert = function (what, index) {
      return index > 0
        ? this.replace(new RegExp('.{' + index + '}'), '$&' + what)
        : what + this;
    };


    function WithinBox(x, y, xStart, yStart, xEnd, yEnd) {
      if (x >= xStart && x <= xEnd) {
        if (y >= yStart && y <= yEnd) {
          return true;
        }
        return false;
      }
    }

    function CheckBox() {
      this.x = 0;
      this.y = 0;
      this.checked = false;
      this.radius = 0;

      this.Render = function (context) {
        this.Clear(context);
        context.strokeRect(this.x, this.y, this.radius * 2, this.radius * 2);
        if (this.checked) {
          context.beginPath();
          context.moveTo(this.x + (this.radius * 0.05), this.y + this.radius - (this.radius * 0.05));
          context.lineTo(this.x + this.radius, this.y + this.radius + (this.radius * 0.9));
          context.lineTo(this.x + this.radius * 2 - (this.radius * 0.05), this.y + (this.radius * 0.05));
          context.stroke();
          context.closePath();
        }
      };

      this.Clear = function (context) {
        context.clearRect(this.x, this.y, this.radius * 2, this.radius * 2);
      }

      this.HandleClick = function (x, y) {
        if (WithinBox(x, y, this.x, this.y, this.x + this.radius * 2, this.y + this.radius * 2)) {
          this.checked = !this.checked;
        }
      };
    }

    var canvas;
    var context;

    function Cursor() {
      this.x = 0;
      this.y = 0;
      this.height = 0;

      var width = 1;

      this.Render = function (context) {
        this.Clear(context);
        context.fillRect(this.x, this.y, width, this.height);
      }

      this.Clear = function (context) {
        context.clearRect(this.x, this.y, width, this.height);
      }
    }

    var CursorDisplay = true;

    function TextBox() {
      this.x = 0;
      this.y = 0;
      this.width = 0;
      this.height = 0;
      this.text = "";
      this.adjustment = 0;
      this.AcceptInput = false;
      this.CursorPosition = 0;

      this.MoveCursorLeft = function () {
        if (this.CursorPosition != 0) {
          this.CursorPosition -= 1;
        }
      }

      this.MoveCursorRight = function () {
        if (this.CursorPosition <= this.text.length) {
          this.CursorPosition += 1;
        }
      }

      this.Render = function (context) {
        //console.log(this.CursorPosition)
        //console.log(this.text.length);
        this.Clear(context);
        context.strokeRect(this.x, this.y, this.width, this.height);
        context.font = (this.height - (this.height * 0.25)) + 'px serif';

        var t = this.text.substring(0, this.CursorPosition);
        //console.log(t);
        var width = context.measureText(t).width;

        var c = new Cursor();

        //console.log(width);
        c.x = (this.x + (this.width * 0.025)) + width - this.adjustment;
        c.y = this.y + (this.height * 0.05);
        c.height = this.height - (this.height * 0.1);

        if (this.AcceptInput && CursorDisplay) {
          c.Render(context);
        }
        else {
          c.Clear(context);
        }

        if (this.text) {
          /*
          if (context.measureText(this.text).width > this.width) {
            if (CursorDisplay) {
              c.Clear(context);
              c.x = this.x + this.width - (this.height * 0.1);
              c.Render(context);
            }
            else {
              c.Clear(context);
            }

            var WidthOfASingleLetter = context.measureText(this.text[0]).width;

            var difference = context.measureText(this.text).width - this.width;

            var result = Math.ceil(difference / WidthOfASingleLetter);

            context.fillText(this.text.substring(result, this.text.length - 1), this.x + (this.width * 0.025), this.y + this.height - (this.height * 0.25));
          }
          else { */

          context.beginPath();
          context.rect(this.x, this.y, this.width, this.height);
          context.clip();
          context.fillText(this.text, (this.x + (this.width * 0.025)) - this.adjustment, this.y + this.height - (this.height * 0.25));
          context.restore();

          //}
        }
      };

      this.Clear = function (context) {
        context.clearRect(this.x, this.y, this.width, this.height);
      }

      this.HandleKeyDown = function (key) {
        if (!this.AcceptInput) {
          return;
        }

        if (key == "Backspace") {
          this.text = this.text.substring(0, this.CursorPosition - 1) + this.text.substring(this.CursorPosition, this.text.length);
          this.MoveCursorLeft();
        }
        else if (key == "ArrowDown") {
          //pass
        }
        else if (key == "Delete") {
          this.text = this.text.substring(0, this.CursorPosition) + this.text.substring(this.CursorPosition + 1, this.text.length);
        }
        else if (key == "ArrowUp") {
          //pass
        }
        else if (key == "ArrowRight") {
          this.MoveCursorRight();
        }
        else if (key == "ArrowLeft") {
          this.MoveCursorLeft();
        }
        else if (key == "Shift") {
          //pass
        }
        else if (key == "Enter") {
          //pass
        }
        else {
          if (this.text == "") {
            this.text = key;
          }
          else {
            this.text = this.text.insert(key, this.CursorPosition);
          }
          this.MoveCursorRight();
        }

        if (context.measureText(this.text.substring(0, this.CursorPosition)).width - this.adjustment >= this.width + this.x - (this.width * 0.025)) {
          //console.log(context.measureText(this.text[this.text.length - 1]));
          this.adjustment += context.measureText(this.text[this.text.length - 1]).width;
        }

        if (context.measureText(this.text.substring(0, this.CursorPosition)).width - this.adjustment <= this.x + (this.width * 0.025)) {
          //console.log(context.measureText(this.text[this.text.length - 1]));
          this.adjustment -= context.measureText(this.text[this.text.length - 1]).width;
          if (this.adjustment < 0) {
            this.adjustment = 0;
          }
        }

        //console.log(this.text);
      }

      this.HandleClick = function (x, y) {
        if (WithinBox(x, y, this.x, this.y, this.x + this.width, this.y + this.height)) {
          this.AcceptInput = true;
        }
        else {
          this.AcceptInput = false;
        }
      };
    }

    $(function () {
      $canvas = $('#main');
      canvas = $canvas[0];
      context = canvas.getContext('2d');

      $(document).keydown(function (e) {
        e.preventDefault();
        HandleKeyDowns(e.key);
      });

      $canvas.click(function (e) {
        //console.log(e.pageX + ' , ' + e.pageY);
        HandleClicks(e.pageX, e.pageY);
      });

      /*
            var b = new CheckBox();
            b.x = 25;
            b.y = 25;
            b.radius = 75;
            b.checked = true;
            b.Render(context);
      
            var b2 = new CheckBox();
            b2.x = 500;
            b2.y = 25;
            b2.radius = 50;
            b2.checked = false;
            b2.Render(context);
      */
      var t = new TextBox();
      t.x = 10;
      t.y = 10;
      t.height = 200;
      t.width = t.height * 4;
      t.Render(context);

      /*
            setInterval(function () {
              CursorDisplay = !CursorDisplay;
              t.Render(context);
            }, 500);*/

      function HandleClicks(x, y) {
        /*b.HandleClick(x, y);
        b.Render(context);
        b2.HandleClick(x, y);
        b2.Render(context);*/
        t.HandleClick(x, y);
        t.Render(context);
      }

      function HandleKeyDowns(key) {
        t.HandleKeyDown(key);
        t.Render(context);
      }

      //c.width = document.width //.clientWidth; //document.width is obsolete
      //c.height = document.height //.clientHeight; //document.height is obsolete
    });
  </script>
</body>

</html>